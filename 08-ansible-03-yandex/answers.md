# Ответы к домашнему заданию по занятию 3 «Использование Ansible»

#### DIFF

```yaml
ansible-playbook site.yml -i inventory/prod.yml --diff
/usr/lib/python3/dist-packages/requests/__init__.py:87: RequestsDependencyWarning: urllib3 (2.1.0) or chardet (4.0.0) doesn't match a supported version!
  warnings.warn("urllib3 ({}) or chardet ({}) doesn't match a supported "

PLAY [Install nginx] ***************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************************************************************************************
ok: [lighthouse-01]

TASK [NGINX | Install epel-release] ************************************************************************************************************************************************************************************************
ok: [lighthouse-01]

TASK [NGINX | Install NGINX] *******************************************************************************************************************************************************************************************************
ok: [lighthouse-01]

TASK [NGINX | Create general config] ***********************************************************************************************************************************************************************************************
ok: [lighthouse-01]

PLAY [Install lighthouse] **********************************************************************************************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************************************************************************************
ok: [lighthouse-01]

TASK [Lighthouse | install dependencies] *******************************************************************************************************************************************************************************************
ok: [lighthouse-01]

PLAY [Install Clickhouse] **********************************************************************************************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************************************************************************************
ok: [clickhouse-01]

TASK [Get clickhouse distrib] ******************************************************************************************************************************************************************************************************
ok: [clickhouse-01] => (item=clickhouse-client)
ok: [clickhouse-01] => (item=clickhouse-server)
failed: [clickhouse-01] (item=clickhouse-common-static) => {"ansible_loop_var": "item", "changed": false, "dest": "./clickhouse-common-static-22.3.3.44.rpm", "elapsed": 0, "gid": 1000, "group": "ifebres", "item": "clickhouse-common-static", "mode": "0664", "msg": "Request failed", "owner": "ifebres", "response": "HTTP Error 404: Not Found", "secontext": "unconfined_u:object_r:user_home_t:s0", "size": 246310036, "state": "file", "status_code": 404, "uid": 1000, "url": "https://packages.clickhouse.com/rpm/stable/clickhouse-common-static-22.3.3.44.noarch.rpm"}

TASK [Get clickhouse distrib resque] ***********************************************************************************************************************************************************************************************
ok: [clickhouse-01]

TASK [Install clickhouse packages] *************************************************************************************************************************************************************************************************
ok: [clickhouse-01]

TASK [Flush handlers] **************************************************************************************************************************************************************************************************************

TASK [Create database] *************************************************************************************************************************************************************************************************************
ok: [clickhouse-01]

PLAY [Install Vector] **************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************************************************************************************
ok: [vector-01]

TASK [Install vector packages] *****************************************************************************************************************************************************************************************************
ok: [vector-01]

TASK [Configure Vector] ************************************************************************************************************************************************************************************************************
ok: [vector-01]

TASK [Configure Vector | Template config] ******************************************************************************************************************************************************************************************
--- before
+++ after: /home/ifebres/.ansible/tmp/ansible-local-472636u9dd5mei/tmpjp498zzh/vector.yml.j2
@@ -0,0 +1,20 @@
+---
+sinks:
+    to_clickhouse:
+        auth:
+            password: clicuser
+            user: paswd123
+        compression: gzip
+        databases: logs
+        endpoint: http://10.128.0.10:8123
+        inputs:
+        - sample-file
+        skip_unknown_fields: true
+        type: clickhouse
+sources:
+    sample_file:
+        ignore_older_secs: 600
+        include:
+        - /home/blekh/logs/*.log
+        read_from: beginning
+        type: file

changed: [vector-01]

TASK [Configure Service] ***********************************************************************************************************************************************************************************************************
--- before
+++ after: /home/ifebres/.ansible/tmp/ansible-local-472636u9dd5mei/tmp9fmvusso/vector.service.j2
@@ -0,0 +1,10 @@
+[Unit]
+Description=Vector Service
+After=network.target
+Requires=network-online.target
+[Service]
+User=ifebres
+Group=1000
+ExecStart=/usr/bin/vector --config-yaml /home/ifebres/vector_config/vector.yml --watch-config true
+Restart=always
+WantedBy=multi-user.target%
\ No newline at end of file

changed: [vector-01]

RUNNING HANDLER [Restart vector service] *******************************************************************************************************************************************************************************************
changed: [vector-01]

PLAY RECAP *************************************************************************************************************************************************************************************************************************
clickhouse-01              : ok=4    changed=0    unreachable=0    failed=0    skipped=0    rescued=1    ignored=0   
lighthouse-01              : ok=6    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
vector-01                  : ok=6    changed=3    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
```
#### DIFF again
```yaml
ansible-playbook site.yml -i inventory/prod.yml --diff
/usr/lib/python3/dist-packages/requests/__init__.py:87: RequestsDependencyWarning: urllib3 (2.1.0) or chardet (4.0.0) doesn't match a supported version!
  warnings.warn("urllib3 ({}) or chardet ({}) doesn't match a supported "

PLAY [Install nginx] ***************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************************************************************************************
ok: [lighthouse-01]

TASK [NGINX | Install epel-release] ************************************************************************************************************************************************************************************************
ok: [lighthouse-01]

TASK [NGINX | Install NGINX] *******************************************************************************************************************************************************************************************************
ok: [lighthouse-01]

TASK [NGINX | Create general config] ***********************************************************************************************************************************************************************************************
ok: [lighthouse-01]

PLAY [Install lighthouse] **********************************************************************************************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************************************************************************************
ok: [lighthouse-01]

TASK [Lighthouse | install dependencies] *******************************************************************************************************************************************************************************************
ok: [lighthouse-01]

PLAY [Install Clickhouse] **********************************************************************************************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************************************************************************************
ok: [clickhouse-01]

TASK [Get clickhouse distrib] ******************************************************************************************************************************************************************************************************
ok: [clickhouse-01] => (item=clickhouse-client)
ok: [clickhouse-01] => (item=clickhouse-server)
failed: [clickhouse-01] (item=clickhouse-common-static) => {"ansible_loop_var": "item", "changed": false, "dest": "./clickhouse-common-static-22.3.3.44.rpm", "elapsed": 0, "gid": 1000, "group": "ifebres", "item": "clickhouse-common-static", "mode": "0664", "msg": "Request failed", "owner": "ifebres", "response": "HTTP Error 404: Not Found", "secontext": "unconfined_u:object_r:user_home_t:s0", "size": 246310036, "state": "file", "status_code": 404, "uid": 1000, "url": "https://packages.clickhouse.com/rpm/stable/clickhouse-common-static-22.3.3.44.noarch.rpm"}

TASK [Get clickhouse distrib resque] ***********************************************************************************************************************************************************************************************
ok: [clickhouse-01]

TASK [Install clickhouse packages] *************************************************************************************************************************************************************************************************
ok: [clickhouse-01]

TASK [Flush handlers] **************************************************************************************************************************************************************************************************************

TASK [Create database] *************************************************************************************************************************************************************************************************************
ok: [clickhouse-01]

PLAY [Install Vector] **************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************************************************************************************
ok: [vector-01]

TASK [Install vector packages] *****************************************************************************************************************************************************************************************************
ok: [vector-01]

TASK [Configure Vector] ************************************************************************************************************************************************************************************************************
ok: [vector-01]

TASK [Configure Vector | Template config] ******************************************************************************************************************************************************************************************
ok: [vector-01]

TASK [Configure Service] ***********************************************************************************************************************************************************************************************************
ok: [vector-01]

PLAY RECAP *************************************************************************************************************************************************************************************************************************
clickhouse-01              : ok=4    changed=0    unreachable=0    failed=0    skipped=0    rescued=1    ignored=0   
lighthouse-01              : ok=6    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
vector-01                  : ok=5    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

```

#### README.md-файл по своему playbook.
[README.md](README.md)

#### Готовый playbook 
[site.yml](playbook%2Fsite.yml)